{% extends "base.html" %}
{% load order_ui %}
{% load tz %}

{% block title %}Деталі замовлення{% endblock %}

{% block content %}

{% include "partials/messages.html" %}

<div class="overflow-hidden rounded-lg border border-slate-200 bg-white shadow-sm">
    <div class="border-b border-slate-200 bg-slate-50/80 px-4 py-3">
        <h1 class="text-lg font-semibold text-slate-900">Замовлення #{{ order.id }}</h1>
    </div>
    <div class="px-4 py-4">
        <dl class="grid gap-3 sm:grid-cols-[minmax(0,auto)_1fr] sm:gap-x-6">
            <dt class="text-sm font-medium text-slate-500">Модель</dt>
            <dd class="text-sm text-slate-900">{{ order.model }}</dd>

            <dt class="text-sm font-medium text-slate-500">Колір</dt>
            <dd class="text-sm text-slate-900">{{ order.color }}</dd>

            <dt class="text-sm font-medium text-slate-500">Вишивка</dt>
            <dd class="text-sm text-slate-900">{{ order.embroidery|yesno:"Так,Ні" }}</dd>

            <dt class="text-sm font-medium text-slate-500">Etsy</dt>
            <dd class="text-sm text-slate-900">{{ order.etsy|yesno:"Так,Ні" }}</dd>

            <dt class="text-sm font-medium text-slate-500">Терміново</dt>
            <dd class="text-sm text-slate-900">{{ order.urgent|yesno:"Так,Ні" }}</dd>

            <dt class="text-sm font-medium text-slate-500">Коментар</dt>
            <dd class="text-sm text-slate-900">{{ order.comment|default:"-" }}</dd>

            <dt class="text-sm font-medium text-slate-500">Створено</dt>
            <dd class="text-sm text-slate-900">{{ order.created_at|date:"d.m.Y H:i" }}</dd>

            <dt class="text-sm font-medium text-slate-500">Закінчено</dt>
            <dd class="text-sm text-slate-900">{% if order.finished_at %}{{ order.finished_at|date:"d.m.Y H:i" }}{% else %}-{% endif %}</dd>

            <dt class="text-sm font-medium text-slate-500">Статус</dt>
            <dd>
                {% status_indicator order.current_status_code order.current_status_display %}
            </dd>
        </dl>
    </div>
</div>

<div class="mt-6 overflow-hidden rounded-lg border border-slate-200 bg-white shadow-sm">
    <div class="border-b border-slate-200 bg-slate-50/80 px-4 py-3">
        <h2 class="text-sm font-semibold text-slate-900">Історія статусів</h2>
    </div>
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-slate-200">
            <thead class="bg-slate-50/80">
                <tr>
                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-slate-400">Статус</th>
                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-slate-400">Змінив</th>
                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-slate-400">Час</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-100 bg-white">
                {% for status in order.status_history %}
                <tr>
                    <td class="whitespace-nowrap px-4 py-2 text-sm text-slate-900">{{ status.new_status_display }}</td>
                    <td class="whitespace-nowrap px-4 py-2 text-sm text-slate-700">{{ status.changed_by }}</td>
                    <td class="whitespace-nowrap px-4 py-2 text-sm text-slate-500">{{ status.changed_at|date:"d.m.Y H:i" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="px-4 py-6 text-center text-sm text-slate-500">Історія статусів відсутня.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="mt-4">
    <a href="{% url 'orders_active' %}" class="text-sm font-medium text-teal-600 hover:text-teal-700 transition-colors">&larr; До поточних замовлень</a>
</div>

{% endblock %}
