{% load static %}
{% load order_ui %}
<!DOCTYPE html>
<html lang="uk"{% if active_theme %} data-theme="{{ active_theme }}"{% endif %}>
	<head>
	    <meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <title>{{ site_name }} · {% block title %}Головна{% endblock %}</title>
	    <link rel="icon" href="{% static 'favicon.svg' %}" type="image/svg+xml">
	    <link rel="preconnect" href="https://fonts.googleapis.com">
	    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
	    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
		    <link href="{% static 'css/app.css' %}" rel="stylesheet">
		    <link href="{% static 'css/brand.css' %}" rel="stylesheet">
		    <link href="{% static 'css/theme_preview.css' %}?v=20260209-night-3" rel="stylesheet">
            <style>
              /* Critical fallback: guarantees a true dark surface for lumen_night even with stale static cache. */
              html[data-theme="lumen_night"] {
                --color-slate-50: #0a0a0d;
                --color-slate-100: #0f1015;
                --color-slate-200: #171a22;
                --color-slate-300: #252a38;
                --color-slate-400: #3a4257;
                --color-slate-500: #58637d;
                --color-slate-600: #7a879f;
                --color-slate-700: #aab3c4;
                --color-slate-800: #d5dae4;
                --color-slate-900: #f1f5f9;
              }
              [data-theme="lumen_night"] body {
                background-color: #0a0a0d;
                color: #e8e9ee;
              }
              [data-theme="lumen_night"] nav,
              [data-theme="lumen_night"] .top-nav {
                background-color: rgba(18, 20, 26, 0.78);
                border-bottom-color: rgba(148, 163, 184, 0.16);
              }
              [data-theme="lumen_night"] .bottom-nav {
                background-color: rgba(18, 20, 26, 0.92);
                border-top-color: rgba(148, 163, 184, 0.16);
              }
              [data-theme="lumen_night"] .bottom-sheet-panel {
                background-color: rgba(18, 20, 26, 0.98);
              }
              [data-theme="lumen_night"] .bg-white,
              [data-theme="lumen_night"] .card {
                background-color: rgba(18, 20, 26, 0.82);
              }
            </style>
		    {% block extra_head %}{% endblock %}
	</head>
<body class="bg-slate-50 font-sans text-slate-800 antialiased" data-has-nav="{% if request.user.is_authenticated %}1{% else %}0{% endif %}">
    <div class="nav-loading-overlay" id="nav-loading-overlay" aria-hidden="true">
        <div class="nav-loading-spinner" aria-label="Завантаження"></div>
    </div>
    {% if request.user.is_authenticated %}
    {% with current_url=request.resolver_match.url_name %}
    {% get_nav_sections as nav_sections %}
    {% get_nav_cta as nav_cta %}

    {# Desktop top navigation (visible ≥768px) #}
    <nav class="top-nav hidden md:block bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
            <div class="flex h-14 items-center justify-between gap-2">
                <a href="{% url 'index' %}" class="brand-logo nav-logo shrink-0 rounded-md px-1.5 py-1 text-slate-900 hover:bg-slate-50 hover:text-slate-900 transition-colors" data-size="sm">
                    <div class="brand-logo-wrap">
                        <div class="brand-logo-inner">
                            <span class="brand-wordmark">{{ site_wordmark }}</span>
                            <span class="brand-emoji-wrap brand-emoji-char" aria-hidden="true">{{ site_emoji }}</span>
                        </div>
                    </div>
                </a>

                {# Page title #}
                <div class="min-w-0 flex-1 px-2">
                    {% if page_title %}<h1 class="nav-page-title">{{ page_title }}</h1>{% endif %}
                </div>

                {# Desktop nav dropdowns #}
                <div class="flex items-center gap-1">
                    {% for section in nav_sections %}
                    {% if section.key != "more" %}
                    {% include "partials/nav_dropdown.html" with section=section %}
                    {% endif %}
                    {% endfor %}

                    <span class="mx-1.5 h-5 w-px bg-slate-200" aria-hidden="true"></span>

                    {# CTA button #}
                    <a href="{% url nav_cta.url_name %}" class="btn-primary px-3 py-1.5 whitespace-nowrap">{{ nav_cta.label }}</a>

                    <span class="mx-1.5 h-5 w-px bg-slate-200" aria-hidden="true"></span>

                    {# More dropdown (icon only) #}
                    {% for section in nav_sections %}
                    {% if section.key == "more" %}
                    <div class="nav-dropdown relative" x-data="{ open: false }">
                        <button
                            type="button"
                            class="nav-dropdown-trigger rounded-md p-2 text-slate-500 hover:bg-slate-50 hover:text-slate-700 transition-colors {% if section.is_active %}bg-teal-50 text-teal-700{% endif %}"
                            @click="open = !open"
                            @keydown.escape.window="open = false"
                            :aria-expanded="open"
                            aria-haspopup="true"
                            aria-label="Більше"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z"/>
                            </svg>
                        </button>
                        <div
                            class="nav-dropdown-panel absolute right-0 top-full z-[60] mt-1 min-w-[160px] rounded-md border border-slate-200 bg-white py-1 shadow-lg"
                            x-show="open"
                            x-transition:enter="transition ease-out duration-100"
                            x-transition:enter-start="opacity-0 scale-95"
                            x-transition:enter-end="opacity-100 scale-100"
                            x-transition:leave="transition ease-in duration-75"
                            x-transition:leave-start="opacity-100 scale-100"
                            x-transition:leave-end="opacity-0 scale-95"
                            @click.outside="open = false"
                            x-cloak
                        >
                            {% for item in section.items %}
                            <a href="{% url item.url_name %}" class="nav-dropdown-item block px-4 py-2 text-sm transition-colors {% if item.is_active %}bg-teal-50 text-teal-700{% else %}text-slate-700 hover:bg-slate-50{% endif %}" {% if item.is_active %}aria-current="page"{% endif %}>{{ item.label }}</a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}

                    <form method="post" action="{% url 'auth_logout' %}" class="m-0 inline-flex">
                        {% csrf_token %}
                        <button type="submit" class="rounded-md px-3 py-1.5 text-sm font-medium text-slate-500 hover:bg-slate-50 hover:text-slate-700 transition-colors">Вийти</button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    {# Mobile title bar #}
    <header class="mobile-title-bar md:hidden bg-white border-b border-slate-200">
        <div class="flex h-14 items-center justify-between px-4">
            <a href="{% url 'index' %}" class="brand-logo nav-logo shrink-0 rounded-md px-1.5 py-1 text-slate-900 hover:bg-slate-50 hover:text-slate-900 transition-colors" data-size="sm">
                <div class="brand-logo-wrap">
                    <div class="brand-logo-inner">
                        <span class="brand-wordmark">{{ site_wordmark }}</span>
                        <span class="brand-emoji-wrap brand-emoji-char" aria-hidden="true">{{ site_emoji }}</span>
                    </div>
                </div>
            </a>
            <div class="min-w-0 flex-1 px-2 text-right">
                {% if page_title %}<h1 class="nav-page-title">{{ page_title }}</h1>{% endif %}
            </div>
        </div>
    </header>

    {# Mobile bottom navigation #}
    <div class="md:hidden">
        {% include "partials/bottom_nav.html" with nav_sections=nav_sections nav_cta=nav_cta %}
    </div>

    {% endwith %}
    {% endif %}
    {% comment %}Layout: default = .main-content (max-w-2xl). Centered pages (login, create order) = .main-centered + inner max-w-2xl. See docs/design/design_components.md. {% endcomment %}
    <main class="{% if page_title_center or not request.user.is_authenticated %}main-centered px-4 py-10 sm:px-6 lg:px-8{% else %}main-content mx-auto px-4 py-6 pb-24 md:pb-6 sm:px-6 lg:px-8{% endif %}">
        <div class="{% if page_title_center or not request.user.is_authenticated %}w-full max-w-2xl mx-auto{% endif %}">
            {% block content %}{% endblock %}
        </div>
    </main>
    <script src="{% static 'js/app.js' %}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
