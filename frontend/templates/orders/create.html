{% extends "base_form_page.html" %}
{% load static %}
{% load order_ui %}

{% block title %}Нове замовлення{% endblock %}

{% block form_content %}
<form method="post" action="{% url 'orders_create' %}">
    {% csrf_token %}

    <div class="space-y-4">
        {% include "partials/form_field.html" with field=form.product label="Модель" %}

        {% if form.is_bundle_mode %}
        <div class="rounded-lg border border-slate-100 p-4 space-y-4">
            <h2 class="text-sm font-semibold text-slate-900">Кольори компонентів</h2>
            {% if form.bundle_component_rows %}
            <div class="space-y-4">
                {% for row in form.bundle_component_rows %}
                <section class="rounded-lg border border-slate-100 p-4">
                    <div class="flex flex-wrap items-baseline gap-x-2 gap-y-1">
                        <h3 class="text-sm font-semibold text-slate-900">{{ row.component.name }}</h3>
                        <span class="text-xs text-slate-500">x{{ row.quantity }}</span>
                    </div>
                    <div class="mt-4 space-y-4">
                        {% with bf=form|get_form_field:row.primary_field_name %}
                        {% include "partials/form_field.html" with field=bf label="Основний колір" %}
                        {% endwith %}
                        {% with bf=form|get_form_field:row.secondary_field_name %}
                        {% include "partials/form_field.html" with field=bf label="Другорядний колір" %}
                        {% endwith %}
                    </div>
                </section>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-sm text-slate-500">Спочатку додай компоненти в бандл.</p>
            {% endif %}
        </div>
        {% else %}
        {% include "partials/form_field.html" with field=form.primary_material_color label="Основний колір" %}
        {% include "partials/form_field.html" with field=form.secondary_material_color label="Другорядний колір" %}
        {% endif %}

        <div class="flex flex-wrap items-center gap-x-6 gap-y-2">
            {% include "partials/form_checkbox_option.html" with field=form.is_etsy label="Etsy" %}
            {% include "partials/form_checkbox_option.html" with field=form.is_embroidery label="Вишивка" %}
            {% include "partials/form_checkbox_option.html" with field=form.is_urgent label="Терміново" %}
            {% if form.is_etsy.errors or form.is_embroidery.errors or form.is_urgent.errors %}
            <p class="form-error w-full">{{ form.is_etsy.errors.0|default:form.is_embroidery.errors.0|default:form.is_urgent.errors.0 }}</p>
            {% endif %}
        </div>

        {% include "partials/form_field.html" with field=form.comment %}

        <div class="pt-1">
            <button type="submit" class="btn-primary w-full min-h-[44px]">
                Створити замовлення
            </button>
        </div>
    </div>
</form>
{% endblock %}

{% block form_page_footer %}
<div class="mt-4">
    <a href="{% url 'orders_active' %}" class="link-back">&larr; Назад до роботи</a>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/orders_create.js' %}"></script>
{% endblock %}
