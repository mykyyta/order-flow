{% extends "base.html" %}
{% load order_ui %}
{% load tz %}

{% block title %}Деталі замовлення{% endblock %}

{% block content %}

{% include "partials/messages.html" %}

{% if back_url %}
<div class="mb-4">
    <a href="{{ back_url }}" class="link-back">&larr; {{ back_label|default:"Назад" }}</a>
</div>
{% endif %}

<div class="card">
    {% include "partials/card_section_header.html" with title=order_card_title edit_url=order_edit_url %}
    <div class="px-5 py-5">
        <dl class="min-w-0 divide-y divide-slate-100">
            <div class="py-2">
                <dt class="sr-only">Модель · Основний колір</dt>
                <dd class="min-w-0 flex items-start justify-between gap-3">
                    <span class="detail-hero min-w-0 truncate">{{ order.product }} · {{ order.color }}</span>
                    <span class="flex-shrink-0">
                        {% status_indicator order.status_code order.status_display %}
                    </span>
                </dd>
            </div>
            <div class="detail-row">
                <dt class="detail-dt">Мітки</dt>
                <dd class="detail-dd">
                    {% if order.is_urgent or order.is_embroidery or order.is_etsy %}
                    {% include "partials/order_tags_icons.html" with order=order %}
                    {% else %}
                    —
                    {% endif %}
                </dd>
            </div>

            {% if order.comment %}
            <div class="detail-row">
                <dt class="detail-dt">Коментар</dt>
                <dd class="detail-dd">
                    <div class="max-h-60 overflow-auto rounded-md border border-slate-200 bg-slate-50/60 px-3 py-2 text-[0.8rem] leading-[1.35] text-slate-800 font-mono whitespace-pre-line">
                        {{ order.comment }}
                    </div>
                </dd>
            </div>
            {% endif %}

            <div class="detail-row">
                <dt class="detail-dt">Створено</dt>
                <dd class="detail-dd">{{ order.created_at|date:"d.m.Y H:i" }}</dd>
            </div>
            <div class="detail-row">
                <dt class="detail-dt">Закінчено</dt>
                <dd class="detail-dd">{% if order.finished_at %}{{ order.finished_at|date:"d.m.Y H:i" }}{% else %}—{% endif %}</dd>
            </div>
        </dl>
    </div>
</div>

<div class="card mt-6">
    {% include "partials/card_section_header.html" with title="Історія статусів" %}
    <div class="sm:hidden">
        {% for status in order.status_history %}
        <div class="border-b border-slate-100 px-4 py-3 last:border-b-0">
            <div class="text-sm font-medium text-slate-900">{{ status.new_status_display }}</div>
            <div class="mt-0.5 flex items-center justify-between gap-2 text-xs text-slate-500">
                <span class="min-w-0 truncate">{{ status.changed_by }}</span>
                <span class="shrink-0">{% if status.changed_at %}{{ status.changed_at|date:"d.m.Y H:i" }}{% else %}—{% endif %}</span>
            </div>
        </div>
        {% empty %}
        <div class="px-4 py-6 text-center text-sm text-slate-500">Історії статусів ще немає.</div>
        {% endfor %}
    </div>

    <div class="hidden sm:block overflow-x-auto">
        <table class="data-table">
            <thead>
                <tr>
                    <th scope="col">Статус</th>
                    <th scope="col">Змінив</th>
                    <th scope="col">Час</th>
                </tr>
            </thead>
            <tbody>
                {% for status in order.status_history %}
                <tr>
                    <td>{{ status.new_status_display }}</td>
                    <td class="text-slate-700">{{ status.changed_by }}</td>
                    <td class="text-slate-500">{% if status.changed_at %}{{ status.changed_at|date:"d.m.Y H:i" }}{% else %}—{% endif %}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="px-4 py-6 text-center text-slate-500">Історії статусів ще немає.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
